<html>
    <head>
        <title>Journal</title>
        <link rel="stylesheet" href="../bootstrap-3.3.7/dist/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="../database.json"></script>
    </head>

    <body onload="show_journal()">
        <div id="journal_div"></div>
        
        <script>
                var acc_type_list="";
                //account subtypes
                var asset_subtype_list="";
                var liability_subtype_list="";
                var unknown_subtype_list="";
                var revenue_subtype_list="";
                var expense_subtype_list="";
                var data="";

            function create_journal(row, col, head, data){
                var journal="";
                var id=1;
                journal = "<table id='journal' class='table table-hover'>";

                journal += "<thead>";
                journal += "<tr>";
                for(i=0; i<col; i++){
                    journal+="<th>"+head[i]+"</th>";
                }//for head
                journal+="</tr>";
                journal+="</thead>";

                journal += "<tbody>";
                //accont types
                acc_type_list=Object.keys(data);

                //creating journal
                for(i=0; i<row; i++){
                    journal += "<tr>";
                    //account number
                    journal += "<td><input id="+id+" type='text'></td>";
                    id++;
                    //account type
                    journal += "<td><select id="+id+" onchange='getSubList(this)' style='width:180px'><option disabled selected value> -- select an option -- </option>";
                    id++;
                    for(account_index=0; account_index<acc_type_list.length; account_index++){
                        journal+="<option value="+acc_type_list[account_index]+">"+acc_type_list[account_index]+"</option>";
                    }//account_type
                    "</select></td>";
                    //account subtype
                    journal += "<td><select id="+id+" onchange='getAccList(this)' style='width:180px'><option disabled selected value> -- select an option -- </option>";
                    id++;
                    journal += "<td><select id="+id+" style='width:180px'><option disabled selected value> -- select an option -- </option>";
                    id++
                    for(k=0; k<2; k++){
                        journal += "<td><input id="+id+" type='text'></td>";
                        id++;
                    }//for debit
                    journal += "</tr>";
                }//for row
                journal += "</tbody>";
                journal += "</table>";
                return journal;
            }//create_journal()

            function getAccList(select_subtype){
                select_subtype_id=select_subtype.getAttribute("id");
                select_subtype_value=select_subtype.value;
            
                select_type=document.getElementById(select_subtype_id-1);
                select_type_value=select_type.value;

                select_acc=document.getElementById(parseInt(select_subtype_id)+1);
                clearSelect(select_acc);

                list=data[select_type_value][select_subtype_value];
                for(i=0;i<list.length;i++){
                    option=document.createElement("option");
                    option.text=list[i]["title"];
                    select_acc.add(option);
                }//for
            }//getAccList
            
            function getSubList(select_type){
                select_type_id=select_type.getAttribute("id");
                select_type_value=select_type.value;

                select_subtype=document.getElementById(parseInt(select_type_id)+1);
                clearSelect(select_subtype);
                list_type=Object.keys(data[select_type_value]);
                for(i=0;i<list_type.length;i++){
                    option=document.createElement("option");
                    option.text=list_type[i];
                    select_subtype.add(option);
                }//for
                select_subtype_value=select_subtype.value;

                select_acc=document.getElementById(parseInt(select_type_id)+2);
                input_acc_num=document.getElementById(parseInt(select_type_id)-1);
                clearSelect(select_acc);
                list_acc=data[select_type_value][select_subtype_value];
                for(i=0;i<list_acc.length;i++){
                    option=document.createElement("option");
                    option.text=list_acc[i]["title"];
                    select_acc.add(option);
                }//for
            }//getSubList

            function clearSelect(select){
                for (i = select.length - 1; i >= 0; i--) {
                    select.remove(i);
                }
            }//clearSelect

            function create_button(func, val){
                var button="";
                button="<button onclick="+func+" class='btn btn-primary'>"+val+"</button>";
                return button;
            }//create_button()

            function create_row(journal, col) {
                    //get the last input id
                    cells=document.getElementsByTagName("td");
                    id=cells[cells.length-1].childNodes[0].getAttribute("id");
                    //insert new row
                    row = journal.insertRow(-1);
                    html = "";
                    html= "<td><input id="+id+" type='text'></td>";
                    //account type
                    html += "<td><select id="+id+" onchange='getSubList(this)' style='width:180px'><option disabled selected value> -- select an option -- </option>";
                    id++;
                    for(account_index=0; account_index<acc_type_list.length; account_index++){
                        html+="<option value="+acc_type_list[account_index].toLowerCase()+">"+acc_type_list[account_index]+"</option>";
                    }//account_type
                    "</select></td>";
                    //account subtype
                    html += "<td><select id="+id+" style='width:180px'><option disabled selected value> -- select an option -- </option>";
                    id++;
                    html += "<td><select id="+id+" style='width:180px'><option disabled selected value> -- select an option -- </option>";
                    id++
                    for(k=0; k<2; k++){
                        html += "<td><input id="+id+" type='text'></td>";
                        id++;
                    }//for debit
                    row.innerHTML=html;
                }//create_row

            function show_journal(){
                $.getJSON("database.json", {},function(database) {
                    data=database;
                    head=["Number", "Type", "Sub-type", "GL Account", "Debit", "Credit"];
                    html="";
                    journal=create_journal(2, 6, head, data);
                    add_row_button=create_button("'create_row(document.getElementById(\"journal\"), 6)'", "More");
                    post_button=create_button("'post_entries(document.getElementById(\"journal\"))'", "Post");
                    html=journal+add_row_button+post_button;
                    document.getElementById("journal_div").innerHTML=html;
                });
            }//show_journal()
        </script>
    </body>
</html>